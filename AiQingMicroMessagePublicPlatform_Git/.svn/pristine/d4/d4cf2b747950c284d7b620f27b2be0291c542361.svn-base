var Dialog=require("common:widget/ui/dialog/dialog.js"),loginApi=require("common:widget/ui/passport/passport.js"),Template=require("common:widget/ui/template/template.js").template,Cookie=require("common:widget/ui/cookie/cookie.js"),Storage=require("common:widget/ui/storage/storage.js"),voiceCheck=require("common:widget/ui/voice_check/voice_check.js"),pwd=require("order:widget/password/main.js"),Session=Storage.session,passBindPhone=require("common:widget/ui/passport_bind_phone/passport_bind_phone.js");$(function(){function t(){$(".buycount-ctrl input").each(function(){var t=$(this),e=t.parents(".j-row");t.val(e.data("buycount"))}),$("#j-bindMobile").on("click",function(){passBindPhone.bind()}),i.bindEvent(),r.bindEvent(),s.bindEvent(),c.bindEvent(),d.bindEvent(),l.bindEvent(),h.bindEvent();var t=F.context("girlsHdDlgCreate");"1"==t&&new Dialog.alert({width:520,title:"提示",content:"该团购3.7元秒杀已结束，您可用原团购价购买。",customClassName:"ui-dialog-girls-act-create"}).center()}var e={isDiscountRequesting:!1,priceFormat:function(t){return(t/100).toFixed(2)},priceFormat2:function(t){return(t/1e3).toFixed(2)},dateFormat:function(t){var e=new Date(t),i=e.getFullYear(),n=e.getMonth()+1,o=e.getDate();return i+"年"+n+"月"+o+"日"}},i={isReserve:F.context("isReserve")?!0:!1,isMulti:F.context("isMulti")?!0:!1,isMultiOption:"1"==F.context("multiOption")?!0:!1,$rows:$("#j-tableGoods .j-row"),$row:$("#j-tableGoods .j-row").eq(0),updateUrl:F.context("ajax_order_update"),updatexhr:null,eachRow:function(t){var e=this.get();this.$rows.each(t),this.setRow(e)},bindEvent:function(){if(i.isMulti){var t=Session.getItem("ORDER_BUY_COUNT");if(t){var e=$.parseJSON(t),n=i.getDealId();if(e[n]){i.setBuyCount(e[n].buyCount),i.requestAndUpdateFinalPrice();var a=e[n].html;i.setMultiPackHtml(a),e[n].options&&(o._options=e[n].options,i.setMultiPackOptions(e[n].options))}}}else{var r=i.getData();if(r){i.setBuyCount(r),i.requestAndUpdateFinalPrice();var s=i.getPersonMin(),c=i.getMax();r>s&&i.get().find(".minus").removeClass("disabled"),c>r&&i.get().find(".plus").removeClass("disabled"),i.get().find(".buycount-ctrl input").val(r)}}$("#j-tableGoods").on("click",".j-ctrl span, .j-ctrl",i.handlers.buyCountCtrlClickHandler).on("keyup","input",i.handlers.buyCountInputKeyupHandler).on("click",".j-dialogTrigger",i.handlers.dialogTriggerClickHandler)},handlers:{buyCountCtrlClickHandler:function(t){var e=$(t.target);if(i.setRowByChild(e),e.hasClass("j-ctrl")||(e=e.parent(),t.stopPropagation()),!e.hasClass("disabled")){var n=e.siblings("input"),o=n.val();n.val(e.hasClass("plus")?++o:--o),i.setBuyCount(o),i.checkBuyCountAndSetErr(),i._updateBuyCount()}},buyCountInputKeyupHandler:function(t){var e=$(t.target),n=parseInt(e.val(),10);isNaN(n)&&(n=0),e.val(n),i.setRowByChild(e),i.setBuyCount(n),i.checkBuyCountAndSetErr(),i._updateBuyCount()},dialogTriggerClickHandler:function(t){i.setRowByChild($(t.target)),i.isReserve?a.show():o.show()}},get:function(){return this.$row},getUnitPrice:function(){return this.$row.data("unitprice")||0},getDealId:function(){return this.$row.data("dealid")},getBuyCount:function(){return this.$row.data("buycount")||0},getMultiPackOptions:function(){return this.$row.data("options")},getPersonMin:function(){return this.$row.data("min")},getPersonMax:function(){return this.$row.data("personmax")},getStock:function(){return this.$row.data("stock")},getMax:function(){return this.$row.data("max")},getPayMoney:function(){return this.$row.data("paymoney")},setRowByChild:function(t){return this.$row=t.parents(".j-row"),this},setRow:function(t){return this.$row=t,this},setBuyCount:function(t){return this.$row.data("buycount",t),this},setMultiPackOptions:function(t){return this.$row.data("options",t),this},setSumPriceHtml:function(t){return this.$row.find(".j-sumPrice").html(e.priceFormat(t)),this},setActivityHtml:function(t){return this.$row.find(".j-cellActivity").html(t),this},setMultiPackHtml:function(t){return this.$row.find(".j-dialogTrigger").html(t),this},setPayMoney:function(t){return this.$row.data("paymoney",t),this},_setErr:function(t){this.$row.find(".j-err-wrap").html(t)},_updateBuyCount:function(){$row=this.$row;var t=$row.find('[type="text"]'),e=t.siblings(".plus"),n=t.siblings(".minus"),o=$row.data("min"),a=$row.data("max"),r=this.getBuyCount();o>=r?(n.addClass("disabled"),r=o):n.removeClass("disabled"),r>=a?(e.addClass("disabled"),r=a):e.removeClass("disabled"),t.val(r),this.setBuyCount(r),i.saveData(),this.requestAndUpdateFinalPrice(0)},checkBuyCountAndSetErr:function(){var t=this.$row,e=t.data("min"),n=t.data("max"),o=t.data("stock"),a=t.data("personmax"),r=i.getBuyCount(),s=!1;return this._setErr(""),e>r?(this._setErr("每人最少购买"+e+"件"),location.hash="j-tableGoods"):r>n?(this._setErr(o>=a?"每人最多购买"+a+"件":"库存不足，最多可购买"+o+"件"),location.hash="j-tableGoods"):s=!0,s},requestAndUpdateFinalPrice:function(t){var n=this.updateUrl;t=t||0;var o=$.extend({},{dealId:i.getDealId(),count:i.getBuyCount(),unitPrice:i.getUnitPrice(),selectedActivityId:r.getSelectedActivityId(),dealOption:i.getMultiPackOptions(),isManual:t},h.client);this.updatexhr&&"function"==typeof this.updatexhr.abort&&this.updatexhr.abort(),e.isDiscountRequesting=!0,this.updatexhr=$.post(n,o,function(n){if(e.isDiscountRequesting=!1,0==n.errno){var o=n.data,a=o.discount,l=o.costInfo||{},h=o.validGiftCards,p=o.redPacketMoney||0;if(a?(r.setParamMoney(a.totalReductionAmount/10).setParamDetail(a.promoDetail),i.setActivityHtml(r.getActivityHtml(a))):(r.setParamMoney(0).setParamDetail(""),i.setActivityHtml("-￥0.00")),1*t===0&&a&&"undefined"!=typeof a.activityList){for(var g=a.activityList,m=[],v=0;v<g.length;v++){var f='<option value="'+g[v].id+'"data-vouchertype="'+g[v].voucherUseType+'"data-hongbaotype=" '+g[v].redpaperUseType+' ">'+g[v].name+"</option>";m.push(f)}m.push('<option value="-1">不使用优惠</option>'),$("#j-discountSelector").html(m.join(""))}i.setPayMoney(l.payMoney),d.isWuliu?(d.setCostAndDesc(l),i.setSumPriceHtml(l.payMoney-l.deliveryCost)):i.setSumPriceHtml(l.payMoney),s.renderVoucherList(h),s.updateVoucherMoney(),s.updateVoucherPriceHtml(),c.setMaxHongbaoMoney(p),c.updateHongbao(),u.updateFinalPrice()}},"json")},saveData:function(){var t=i.getDealId(),e=i.getBuyCount(),n=Session.getItem("ORDER_BUY_COUNT"),o={};n&&(o=$.parseJSON(n)),o[t]=e,n=$.stringify(o),Session.setItem("ORDER_BUY_COUNT",n)},getData:function(){var t=i.getDealId(),e=Session.getItem("ORDER_BUY_COUNT");if(e){var n=$.parseJSON(e),o=n[t];if(o>0)return o}return null},deleteData:function(){var t=i.getDealId(),e=Session.getItem("ORDER_BUY_COUNT");if(e){var n=$.parseJSON(e);delete n[t],e=$.stringify(n),Session.setItem("ORDER_BUY_COUNT",e)}}},n={$row:null,set:function(t){return this.$row=t.parents(".j-row"),this},setRow:function(t){return this.$row=t,this},setBuyCount:function(t){return this.$row.data("buycount",t),o._updateBuyCount(),this},setError:function(t){return this.$row.find(".j-err-wrap").html(t),this},get:function(){return this.$row},getOptionId:function(){return this.$row.data("optionid")},getStock:function(){return this.$row.data("stock")},getBuyCount:function(){var t=parseInt(this.$row.data("buycount"),10);return isNaN(t)?0:t},getName:function(){return this.$row.data("name")},activate:function(){var t=this.$row;return t.hasClass("deactive-row")?(t.removeClass("deactive-row"),t.find('input[type="checkbox"],input[type="radio"]').prop("checked",!0),t.find('input[type="text"]').val("1"),this.setBuyCount(1),this):this},deactivate:function(){var t=this.$row;return t.addClass("deactive-row"),t.find('input[type="checkbox"],input[type="radio"]').prop("checked",!1),t.find('input[type="text"]').val(""),this.setError(""),this.setBuyCount(0),this},checkBuyCount:function(){var t=this.getStock(),e=i.getMax(),n=this.getBuyCount(),a=o._getBuyCount();return this.setError(n>t?"最多购买"+t+"件":""),o.setError(a>e?"最多购买"+e+"件":""),this},checkStock:function(){var t=this.getStock(),e=this.getBuyCount();return e>t?(this.setError("最多购买"+t+"件"),!1):(this.setError(""),!0)}},o={_dialog:null,$rows:null,_buyCount:0,_tplFunc:Template("t:chooseBody"),_itemOptions:F.context("itemOption"),_tmpItemOptions:[],_options:{},_multiPackHtmlArr:"",eachRow:function(t){var e=n.get();this.$rows.each(t),n.setRow(e)},show:function(){var t=this._itemOptions,e=Session.getItem("ORDER_BUY_COUNT");if(e){var o=$.parseJSON(e),a=i.getDealId();o[a]&&o[a].itemOptions&&o[a].itemOptions&&(t=o[a].itemOptions)}var r=this._tplFunc({isMultiOption:i.isMultiOption,list:t});this._dialog=new Dialog({width:564,title:"选择类型和数量",content:r,footer:'（每人限购数量：<span class="person-max">'+i.getPersonMax()+'</span>）<a href="javascript:;" class="dialog-btn-ok j-dialog-btn" data-event="confirm">确&nbsp;定</a>',customClassName:"ui-dialog-opq"}).center().on("confirm",this._getDialogConfirmHandler()).on("check",this._getDialogCheckHandler()).on("minus",this._getDialogMinusHandler()).on("plus",this._getDialogPlusHandler()),this._dialog.getDom().find('input[type="text"]').on("focus",this._getInputFocusHandler()).on("keyup",this._getInputKeyupHandler()),this._dialog.getDom().find(".container").on("mousewheel DOMMouseScroll",function(t){var e=t.originalEvent,i=e.wheelDelta||-e.detail;this.scrollTop+=30*(0>i?1:-1),t.preventDefault()}),this.$rows=this._dialog.getDom().find(".j-row"),this.isMultiOption||n.setRow(this.$rows.not(".deactive-row")),this._getDialogHeight()},_getDialogHeight:function(){$("#j-goods-wrap table").height()<320&&($("#j-goods-wrap .goods-wrap").height($("#j-goods-wrap table").height()+3),$("#j-goods-wrap li.th-type").width(285),$("#j-goods-wrap li.th-num").width(180))},_getDialogConfirmHandler:function(){var t=this;return function(){if(t._updateBuyCount(),t._checkBuyCount()){i.setMultiPackHtml(t._getMultiPackHtml()),t._saveItemOptions(),i.setMultiPackOptions(t._getMultiPackOptions()),i.setBuyCount(t._getBuyCount()),i.checkBuyCountAndSetErr();var e=Session.getItem("ORDER_BUY_COUNT"),n={};e&&(n=$.parseJSON(e));var a=i.getDealId();return n[a]||(n[a]={}),n[a].html=o._getMultiPackHtml(),n[a].buyCount=i.getBuyCount(),n[a].itemOptions=o._itemOptions,n[a].options=o._getMultiPackOptions(),e=$.stringify(n),Session.setItem("ORDER_BUY_COUNT",e),i.requestAndUpdateFinalPrice(),!0}return!1}},_getDialogCheckHandler:function(){return function(t){var e=$(t.target);return i.isMultiOption?(n.set(e),e.prop("checked")?n.activate().checkBuyCount():n.deactivate()):e.parents(".j-row").get(0)!=n.get().get(0)&&n.deactivate().set(e).activate().checkBuyCount(),!1}},_getDialogMinusHandler:function(){return function(t){var e=$(t.target);e.hasClass("ctrl")||(e=e.parent(),t.stopPropagation());var i=e.siblings("input"),o=i.val();return i.val(--o),n.set(e).setBuyCount(o),0>=o?n.deactivate():n.checkBuyCount(),!1}},_getDialogPlusHandler:function(){return function(t){var e=$(t.target);e.hasClass("ctrl")||(e=e.parent(),t.stopPropagation());var i=e.siblings("input"),o=i.val();return i.val(++o),n.set(e).setBuyCount(o).checkBuyCount(),!1}},_getInputFocusHandler:function(){return function(t){var e=$(t.target);i.isMultiOption?n.set($(t.target)).activate().checkBuyCount():e.parents(".j-row").get(0)!=n.get().get(0)&&n.deactivate().set($(t.target)).activate().checkBuyCount()}},_getInputKeyupHandler:function(){return function(t){var e=$(t.target),i=parseInt(e.val(),10);isNaN(i)&&(i=1),e.val(i),n.set(e).setBuyCount(i).checkBuyCount()}},_checkBuyCount:function(){var t=i.getMax(),e=i.getPersonMin(),o=this._getBuyCount(),a=!0;return o>t&&(this.setError("最多购买"+t+"件"),a=!1),e>o&&(this.setError("最少购买"+e+"件"),a=!1),this.eachRow(function(){n.setRow($(this)),n.checkStock()||(a=!1)}),a?(this.setError(""),!0):!1},setError:function(t){$("#j-allErrWrap").html(t)},_updateBuyCount:function(){var t=this,e=0,o=[],a=[];return $.extend(!0,this._tmpItemOptions,this._itemOptions),this.eachRow(function(r){n.setRow($(this));var s=n.getBuyCount();s>0?(e+=s,o.push(n.getName()+"*"+s),a.push({id:n.getOptionId(),count:s,price:i.getUnitPrice()}),t._tmpItemOptions[r].buy_count=s):delete t._tmpItemOptions[r].buy_count}),this._buyCount=e,this._multiPackHtmlArr=o,this._options=a,this},_getBuyCount:function(){return this._buyCount},_getMultiPackHtml:function(t){t=t>1?t:5;var e=this._multiPackHtmlArr.length,i=this._multiPackHtmlArr.slice(0,t);return e>5&&i.push("......"),i.push('<span class="multi-pack-sum">共'+this._buyCount+"件</span>"),i.join("<br>")},_getMultiPackOptions:function(){return this._options},_saveItemOptions:function(){this._itemOptions=this._tmpItemOptions,this._tmpItemOptions=[]}},a={_dialog:null,_tplFunc:Template("t:ReserveWrap"),_reserveOptions:F.context("reserveOption"),_tmpOptions:{optionId:"",cityId:"",cityName:"选择城区",storeId:"",storeName:"选择分店",storeList:[],reserveTime:"",buyCount:1,stock:0,address:"",isFirstShowDialog:!0},_storeList:[],_isShowAddress:!1,_isSelectCity:!1,_isFirstShowDialog:!0,set:function(t){return this.$row=t.parents(".j-row"),this},getStock:function(){return parseInt($("#j-dealstock").html())},show:function(){var t=this,e=t._tplFunc({merchantList:t._reserveOptions,defaultData:t._tmpOptions});if(t._isFirstShowDialog)var i='<div class="address-wrap hide" id="j-address-wrap"><span class="fl"></span><p class="fr" id="j-address-txt"></p></div><a href="javascript:;" class="dialog-btn-ok j-dialog-btn" data-event="confirm">确&nbsp;定</a>';else var i='<div class="address-wrap" id="j-address-wrap"><span class="fl"></span><p class="fr" id="j-address-txt">'+t._tmpOptions.address+'</p></div><a href="javascript:;" class="dialog-btn-ok j-dialog-btn" data-event="confirm">确&nbsp;定</a>';t._dialog=new Dialog({width:774,title:"预约",content:e,footer:i,customClassName:"ui-dialog-reserve"}).center().on("confirm",t._getDialogConfirmHandler()).on("minus",t._getDialogMinusHandler()).on("plus",t._getDialogPlusHandler()),t._dialog.getDom().find("input.j-buy-num").on("keyup",t._getInputKeyupHandler()),t._isFirstShowDialog||(t._rendStoreList(),t._getRealstock()),t.selectCityWrap=t._dialog.getDom().find(".select-city-wrap"),t.selectStoreWrap=t._dialog.getDom().find(".select-store-wrap"),t._dialog.getDom().find(".j-select").on("click",function(){return t.hideSelect(),$(this).hasClass("select-store-form")&&"选择城区"==t._tmpOptions.cityName?void t.selectCityWrap.addClass("select-city-wrap-warning"):void $(this).parent(".select-wrap").addClass("select-wrap-active")}),t._dialog.getDom().find(".j-options").on("mouseover",function(t){var e=$(t.target);e.is("li")&&(e.hasClass("option-active")||e.addClass("option-active"))}).on("mouseout",function(t){var e=$(t.target);e.is("li")&&e.hasClass("option-active")&&e.removeClass("option-active")}).on("click",function(e){var i=$(e.target);if(i.is("li")){var n=i.html(),o=i.data("id");i.parents(".select-wrap").find(".j-select-form-txt").html(n),i.parents(".select-wrap").removeClass("select-wrap-active"),i.parents(".select-wrap").hasClass("select-city-wrap-warning")&&i.parents(".select-wrap").removeClass("select-city-wrap-warning"),i.parents(".select-wrap").hasClass("select-city-wrap")?(t._isSelectCity&&t._tmpOptions.cityId!=o&&t._resetForm(),t._tmpOptions.cityName=n,t._tmpOptions.cityId=o,t._rendStoreList(),t._isSelectCity=!0):i.parents(".select-wrap").hasClass("select-store-wrap")&&(t._tmpOptions.storeName=n,t._tmpOptions.storeId=o,t._showStoreAddress(),t._getRealstock(),t.setTrError("success"),t.setHeaderError(""))}}),t._isFirstShowDialog&&(t._dialog.getDom().find(".j-select-datepicker").val(t.getToday()),t._tmpOptions.reserveTime=t.getToday()),t._dialog.getDom().find(".j-select-datepicker").on("click",function(){t.hideSelect()}).datepicker({minDate:0,dateFormat:"yy-mm-dd",dayNamesMin:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],onSelect:function(e){t._tmpOptions.reserveTime=e,t._getRealstock(),t.setHeaderError("")}})},hideSelect:function(){var t=this;t.selectCityWrap.hasClass("select-wrap-active")&&t.selectCityWrap.removeClass("select-wrap-active"),t.selectStoreWrap.hasClass("select-wrap-active")&&t.selectStoreWrap.removeClass("select-wrap-active")},getToday:function(){var t,e,i,n;return date=new Date,date.setDate(date.getDate()),t=date.getFullYear(),e=date.getMonth()+1,i=date.getDate(),10>e&&(e="0"+e),10>i&&(i="0"+i),n=t+"-"+e+"-"+i},formatDate:function(t){var e=t.split(t.match(/\D+/g)[0]),i=e[1]+"月"+e[2]+"日";return i},_getStartTimeStamp:function(){var t=this._tmpOptions.reserveTime.split("-"),e=new Date(t[0],t[1]-1,t[2],0,0,0);return Date.parse(e)/1e3},_getEndTimeStamp:function(){var t=this._getStartTimeStamp()+86400;return t},_rendStoreList:function(){for(var t=0;t<this._reserveOptions.length;t++){var e="",i=this._reserveOptions[t];if(i.id==this._tmpOptions.cityId){this._storeList=i.subbranch,this._tmpOptions.storeList=[];for(var t=0;t<this._storeList.length;t++){var n=this._storeList[t],o='<li data-id="'+n.merchant_id+'">'+n.name+"</li>";e+=o,this._tmpOptions.storeList.push({id:n.merchant_id,name:n.name})}this.selectStoreWrap.find(".j-options").html(e);break}}},_showStoreAddress:function(){for(var t=0;t<this._storeList.length;t++){var e=this._storeList[t];e.merchant_id==this._tmpOptions.storeId&&(this._isShowAddress||(this._dialog.getDom().find("#j-address-wrap").removeClass("hide"),this._isShowAddress=!0),this._dialog.getDom().find("#j-address-txt").html(e.address),this._tmpOptions.address=e.address)}},_getRealstock:function(){var t=this,e={deal_id:i.getDealId(),merchant_id:this._tmpOptions.storeId,begin_time:this._getStartTimeStamp(),end_time:this._getEndTimeStamp()};$.post("/pcorder/Detail/shopstock",e,function(e){if(0==e.errno){var i=e.data.stock_info;t._setRealstock(i.remain_stock),i.remain_stock<1&&t.setHeaderError("库存不足，请选择其他时间和分店"),t._tmpOptions.stock=i.remain_stock,t._tmpOptions.optionId=i.option_id}else t.setHeaderError(e.msg)},"json")},_setRealstock:function(t){$("#j-dealstock").html(t)},_resetForm:function(){this.selectStoreWrap.find(".j-select-form-txt").html("选择分店"),this._dialog.getDom().find(".j-select-datepicker").val(this.getToday()),this._setRealstock("--"),this._isShowAddress&&(this._dialog.getDom().find("#j-address-wrap").addClass("hide"),this._isShowAddress=!1,this._dialog.getDom().find("#j-address-txt").html("")),this._dialog.getDom().find(".j-buy-num").val(1),this.setTrError("success"),this.setHeaderError("")},_getDialogMinusHandler:function(){var t=this;return function(e){t.hideSelect();var i=$(e.target);if(i.hasClass("ctrl")||(i=i.parent(),e.stopPropagation()),i.hasClass("disabled"))return!1;var n=i.siblings("input"),o=n.val();return"选择城区"==t._tmpOptions.cityName?(t.setTrError("请选择城区和分店"),!1):"选择分店"==t._tmpOptions.storeName?(t.setTrError("请选择分店"),!1):1>=o?(i.addClass("disabled"),t.setTrError("预约份数需大于0"),t._tmpOptions.buyCount=1,!1):(t.setTrError("success"),n.val(--o),t._tmpOptions.buyCount=o,!1)}},_getDialogPlusHandler:function(){var t=this;return function(e){t.hideSelect();var i=$(e.target);i.hasClass("ctrl")||(i=i.parent(),e.stopPropagation());var n=i.siblings("input"),o=parseInt(n.val());return"选择城区"==t._tmpOptions.cityName?(t.setTrError("请选择城区和分店"),!1):"选择分店"==t._tmpOptions.storeName?(t.setTrError("请选择分店"),!1):o>=t._tmpOptions.stock?(t.setTrError("库存不足，请选择其他时间和分店"),!1):(t.setTrError("success"),n.val(++o),o>1&&i.siblings(".minus").hasClass("disabled")&&i.siblings(".minus").removeClass("disabled"),t._tmpOptions.buyCount=o,!1)}},_getInputKeyupHandler:function(){var t=this;return function(e){t.hideSelect();var i=$(e.target),n=parseInt(i.val(),10);return isNaN(n)&&(n=1),t._tmpOptions.buyCount=n,n>1&&i.siblings(".minus").hasClass("disabled")&&i.siblings(".minus").removeClass("disabled"),"选择城区"==t._tmpOptions.cityName?(t.setTrError("请选择城区和分店"),!1):"选择分店"==t._tmpOptions.storeName?(t.setTrError("请选择分店"),!1):n>t._tmpOptions.stock?(t.setTrError("库存不足，请选择其他时间和分店"),!1):1>n?(t.setTrError("预约份数需大于0"),!1):(i.val(n),void t.setTrError("success"))}},_getDescTxt:function(){var t=this._tmpOptions.cityName+this._tmpOptions.storeName+this.formatDate(this._tmpOptions.reserveTime)+"*"+this._tmpOptions.buyCount+'<br /><span class="multi-pack-sum">共'+this._tmpOptions.buyCount+"件</span>";return t},_getParams:function(){var t=[];return t.push({id:this._tmpOptions.optionId,count:this._tmpOptions.buyCount,price:i.getUnitPrice()}),t},_getDialogConfirmHandler:function(){var t=this;return function(e){t.hideSelect(),t._isFirstShowDialog=!1,t._tmpOptions.isFirstShowDialog=!1;$(e.target).parents(".j-row");return t._checkSumbitContent()?(i.setMultiPackHtml(t._getDescTxt()),i.setBuyCount(t._tmpOptions.buyCount),i.setMultiPackOptions(t._getParams()),i.requestAndUpdateFinalPrice(),!0):!1}},setTrError:function(t){return"success"==t?($("#j-err-wrap").removeClass("j-err-tab"),$("#j-err-wrap").find(".j-err-wrap").html("")):($("#j-err-wrap").addClass("j-err-tab"),$("#j-err-wrap").find(".j-err-wrap").html(t)),this},setHeaderError:function(t){$("#j-allErrWrap").html(t)},_checkSumbitContent:function(){return"选择城区"==this._tmpOptions.cityName?(this.setHeaderError("请选择城区和分店"),!1):"选择分店"==this._tmpOptions.storeName?(this.setHeaderError("请选择分店"),!1):this._tmpOptions.stock<1?(this.setHeaderError("库存不足，请选择其他时间和分店"),!1):this._tmpOptions.buyCount<1?(this.setHeaderError("预约份数需大于0"),!1):!0}},r={_promoMoney:F.context("totalReductionAmount")/10||0,_promoDetail:F.context("promoDetail")||"",_activityList:F.context("activityList")||"",_shitActivityList:F.context("shitActivityList")||"",$discountSelector:$("#j-discountSelector"),bindEvent:function(){r.$discountSelector.find("option").eq(0).attr("selected","selected"),r.$discountSelector.on("change",r.handlers.discountSelectorHandler)},handlers:{discountSelectorHandler:function(){r.canUseVoucher()&&!s.switchHideVoucher?s.$useVoucher.removeClass("voucher-disable"):(s.$useVoucher.addClass("voucher-disable"),s.cancelVoucher());var t=$("#j-tip-seckill"),e=+r.getSelectedActivityId();$.each(r._shitActivityList,function(i,n){if(e===n.id){var o=n.seckillTime;o?(t.show(),t.find(".seckilltime").text(o),$("#j-sweetTip").show()):($("#j-sweetTip").hide(),t.hide())}}),i.requestAndUpdateFinalPrice(1)}},setParamMoney:function(t){return this._promoMoney=t,this},setParamDetail:function(t){return this._promoDetail=t,this},getPromoMoney:function(){return this._promoMoney||0},getPromoDetail:function(){return this._promoDetail},getParamIds:function(){for(var t="",e=0,i=this._activityList.length;i>e;e++)t=""==t?this._activityList[e].id:t+","+this._activityList[e].id;return this.discountIds=t,this.discountIds},getActivityHtml:function(t){var n=[],o=t.activityList||[],a=t.itemList[i.getDealId()]||{},r=a.activityList||[],s=o.concat(r),n="-￥"+e.priceFormat2(s[0].reductionAmount)+"<br/>";return n},getSelectedActivityId:function(){return this.$discountSelector.find("option:selected").val()||-1},canUseVoucher:function(){var t=r.$discountSelector.find("option:selected").data("vouchertype");return!(1==t||2==t)},canUseHongbao:function(){var t=r.$discountSelector.find("option:selected").data("hongbaotype");return!(1==t||2==t)}},s={_tplFunc:Template("t:voucherList"),switchHideVoucher:1==F.context("switchHideVoucher")?!0:!1,usingVoucher:!1,_userCheckedId:null,isActivating:!1,activateUrl:F.context("ajax_voucher_activate"),validlistUrl:F.context("ajax_voucher_validlist"),$useVoucher:$("#j-useVoucher"),$voucherPrice:$("#j-voucherPrice"),$voucherArea:$("#j-voucherArea"),$addVoucher:$("#j-addVoucher"),$voucherInput:$("#j-voucherInput"),$voucherPopTip:$("#voucher-poptip"),$voucherTipActivity:$("#voucher-tip-activity"),bindEvent:function(){s.$voucherArea.on("click",'[name="voucher"]',s.handlers.switchVoucherHandler),s.$useVoucher.on("click",s.handlers.useVoucherClickHandler),s.$addVoucher.on("click",s.handlers.addVoucherClickHandler),s.$useVoucher.on("mouseover",s.handlers.useVoucherMouseoverHandler),s.$useVoucher.on("mouseout",s.handlers.useVoucherMouseoutHandler)},handlers:{useVoucherClickHandler:function(){r.canUseVoucher()&&(s.$useVoucher.hasClass("active")?s.cancelVoucher():s.checkVoucher(),c.updateHongbao(),u.updateFinalPrice())},useVoucherMouseoverHandler:function(){r.canUseVoucher()||(s.$voucherTipActivity.html(r.$discountSelector.find("option:selected").text()),s.$voucherPopTip.show())},useVoucherMouseoutHandler:function(){"none"!=s.$voucherPopTip.css("display")&&s.$voucherPopTip.hide()},switchVoucherHandler:function(){s._setUserCheckedId(s._getRadioId()),s.updateVoucherMoney(),s.updateVoucherPriceHtml(),c.updateHongbao(),u.updateFinalPrice()},addVoucherClickHandler:function(){s.ajaxAddVoucher(function(){s.ajaxGetVoucherList(function(){s.renderVoucherList(giftCard),s.updateVoucherMoney(),s.updateVoucherPriceHtml(),c.updateHongbao(),u.updateFinalPrice()})})}},ajaxAddVoucher:function(t){if(!s.isActivating){var e=s.activateUrl,n=$.trim(s.$voucherInput.val());if(s._setAddVoucherErr(""),""==n)return void s._setAddVoucherErr("请输入抵用券激活码");var o={code:n,payMoney:i.getPayMoney(),tags:h.client.tags,catg_ids:h.client.catg_ids,deal_id:i.getDealId()};s.isActivating=!0,$.post(e,o,function(e){return s.isActivating=!1,0!=e.errno?void s._setAddVoucherErr(e.msg):(s.$voucherInput.val(""),Dialog.splash({title:"",content:"<span>抵用券激活成功！</span>",width:250,customClassName:"ui-coupon-success",timeout:3e3,mask:{enable:!0,opacity:.25}}),"function"==typeof t&&t(),void 0)},"json")}},ajaxGetVoucherList:function(t){var e=this.validlistUrl,n={payMoney:i.getPayMoney(),tags:h.client.tags,catg_ids:h.client.catg_ids,deal_id:i.getDealId()};$.get(e,n,function(e){if(!(e.errno>0)&&"function"==typeof t){var i=e.data.giftCard;t(i)}},"json")},getVoucherMoney:function(){return s.usingVoucher?s.$useVoucher.data("money"):0},getVoucherId:function(){return s.usingVoucher?s.$useVoucher.data("id"):""},getVoucherName:function(){return s.usingVoucher?s.$useVoucher.data("name"):""},_getUserCheckedId:function(){return this._userCheckedId},_setUserCheckedId:function(t){return this._userCheckedId=t,this},_getCheckedRadio:function(){return $('[name="voucher"]').filter(function(){return $(this).prop("checked")})},_getRadioMoney:function(){return this._getCheckedRadio().data("money")},_getRadioId:function(){return this._getCheckedRadio().data("id")},_getRadioName:function(){return this._getCheckedRadio().data("name")},updateVoucherMoney:function(){var t=s._getRadioMoney(),e=i.getPayMoney(),n=d.getDeliveryCost(),o=e-n,a=Math.min(t,o);s.$useVoucher.data({id:s._getRadioId(),money:a,name:s._getRadioName()})},updateVoucherPriceHtml:function(){s.$voucherPrice.html(e.priceFormat(s.getVoucherMoney()))},_showList:function(){$("#j-voucherArea").show()},_hideList:function(){$("#j-voucherArea").hide()},checkVoucher:function(){s.usingVoucher=!0,s.$useVoucher.addClass("active"),s.updateVoucherPriceHtml(),s._showList()},cancelVoucher:function(){s.usingVoucher=!1,s.$useVoucher.removeClass("active"),s.updateVoucherPriceHtml(),s._hideList()},cancelVoucherAndUpdateFinalPrice:function(){s.cancelVoucher(),u.updateFinalPrice()},renderVoucherList:function(t){t instanceof Array&&t.length>0?($("#j-voucherList").html(s._genVoucherList(t)),$("#j-voucherListArea").show()):($("#j-voucherListArea").hide(),$("#j-voucherList").html(""))},_genVoucherList:function(t){for(var i=this._getUserCheckedId(),n=!1,o=0,a=t.length;a>o;o++){var r=t[o];r.money_formatted=e.priceFormat(r.money),r.expireTime_formatted=e.dateFormat(1e3*r.expireTime),i&&r.id==i&&(r.checked=!0,n=!0)}return n||(t[0].checked=!0,this._setUserCheckedId(null)),this._tplFunc({list:t})},_setAddVoucherErr:function(t){$("#j-addVoucherErrWrap").html(t)}},c={canUseHongbao:F.context("canUseHongbao"),usingHongbao:!1,$useHongbao:$("#j-useHongbao"),$hongbaoPrice:$("#j-hongbaoPrice"),bindEvent:function(){c.$useHongbao.on("click",c.handlers.useHongbaoClickHandler)},handlers:{useHongbaoClickHandler:function(){c.$useHongbao.hasClass("active")?c.cancelHongbao():c.checkHongbao(),u.updateFinalPrice()}},updateHongbao:function(){var t=c.getMaxHongbaoMoney();if(0>=t)return c.canUseHongbao=!1,void c.$useHongbao.hide();if(!r.canUseHongbao())return c.canUseHongbao=!1,void c.$useHongbao.hide();var e=i.getPayMoney()-s.getVoucherMoney()-d.getDeliveryCost(),n=Math.min(t,e);return c.setHongbaoMoney(n),0>=n?(c.canUseHongbao=!1,void c.$useHongbao.hide()):(c.canUseHongbao=!0,c.updateHongbaoPriceHtml(),c.$useHongbao.show(),void c.checkPassword())},getHongbaoMoney:function(){return c.canUseHongbao&&c.usingHongbao?parseInt(c.$useHongbao.data("money"),10)||0:0},setMaxHongbaoMoney:function(t){c.$useHongbao.data("maxmoney",t)},getMaxHongbaoMoney:function(){return parseInt(c.$useHongbao.data("maxmoney"),10)||0},setHongbaoMoney:function(t){c.$useHongbao.data("money",t)},updateHongbaoPriceHtml:function(){c.$hongbaoPrice.html(e.priceFormat(c.getHongbaoMoney()))},checkHongbao:function(){c.usingHongbao=!0,c.$useHongbao.addClass("active"),c.updateHongbaoPriceHtml(),c.checkPassword()},cancelHongbao:function(){c.usingHongbao=!1,c.$useHongbao.removeClass("active"),pwd.getVm().activeHongbao=!1,c.updateHongbaoPriceHtml()},checkPassword:function(){if(c.$useHongbao.hasClass("active")){var t=c.getHongbaoMoney();pwd.getVm().hongbaoMoney=t,pwd.checkUseHongbao()}}},u={$finalPrice:$("#j-finalPrice"),get:function(){return this.$finalPrice.data("price")||0},getParam:function(){var t=this.get();return 0>t?0:t},set:function(t){this.$finalPrice.data("price",t),t=t>0?t:0,this.$finalPrice.html(e.priceFormat(t)),t>5e4?$("#j-exceedTip").show():$("#j-exceedTip").hide()},updateFinalPrice:function(){var t=i.getPayMoney(),e=s.getVoucherMoney(),n=c.getHongbaoMoney(),o=t-e-n;u.set(o)}},d={isWuliu:F.context("isWuliu"),addrUrl:F.context("ajax_uc_addrmod"),bindEvent:function(){$("#j-editAddressLink").on("click",this._editAddressLinkClickHandler),$('[name="addressRadio"]').on("click",this._getAddressRadioClickHandler()),$("#j-editTimeLink").on("click",this._editTimeLinkClickHandler),$("#j-allAddress").on("click",".j-setDefaultAddress",this._setDefaultLinkClickHandler),$(".j-address-row").on({touchstart:function(){$(this).addClass("hover")},mouseenter:function(){$(this).addClass("hover")},mouseleave:function(){$(this).removeClass("hover")}})},check:function(){var t=!0,e=this._getCheckedAddressRadioValue();return("undefined"==typeof e||"new"==e)&&(F.checkAddressInfoForSubmit()||(t=!1)),t},get:function(){var t={},e=this._getCheckedAddressRadioValue();return"undefined"==typeof e||"new"==e?t=F.getAddressParams():t.id=e,t.delivery=this._getCheckedTimeRadioValue(),t.mark=$.trim($("#j-wuliuMark").val()),t},getDeliveryCost:function(){return $("#j-deliveryCost").data("deliverycost")||0},setCostAndDesc:function(t){$("#j-deliveryCost").html(e.priceFormat(t.deliveryCost)),$("#j-deliveryCost").data("deliverycost",t.deliveryCost);var i="",n=t.feeToNDC,o=t.numToNDC;n>0?i="再买"+e.priceFormat(n)+"元就免运费":o>0&&(i="再买"+o+"件就免运费");var a=!1;(n>0&&1e4>=n||o>0&&10>=o)&&(a=!0),a?$("#j-DeliveryCostDesc").show():$("#j-DeliveryCostDesc").hide(),$("#j-DeliveryCostDesc").html(i)},_setDefaultLinkClickHandler:function(t){var e=$(t.target),i=e.parents(".address-row");i.addClass("default-address").siblings().removeClass("default-address"),$.ajax({type:"post",url:d.addrUrl,dataType:"json",data:{action:"setd",id:i.find('[name="addressRadio"]').val()}})},_editAddressLinkClickHandler:function(){$("#j-defaultAddress").hide(),$("#j-allAddress").show()},_editTimeLinkClickHandler:function(){$("#j-defaultTime").hide(),$("#j-allTime").show()},_getAddressRadioClickHandler:function(){var t=this;return function(){var e=t._getCheckedAddressRadioValue();"new"==e?$("#j-addressDetail").show():$("#j-addressDetail").hide()}},_getCheckedRadio:function(t){return $('[name="'+t+'"]').filter(function(){return $(this).prop("checked")})},_getCheckedAddressRadioValue:function(){return this._getCheckedRadio("addressRadio").val()},_getCheckedTimeRadioValue:function(){return this._getCheckedRadio("timeRadio").val()}},l={needPersonal:F.context("needPersonal"),$form:$("#j-personalTableForm"),bindEvent:function(){},checkAll:function(){return!0},getParams:function(){for(var t=this.$form.serialize(),e=t.split("&"),i={},n=0,o=e.length;o>n;n++){var a=e[n].split("=");i[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return i}},h={isSecKill:F.context("isSecKill"),client:F.context("client")||{},hasLoggedIn:F.context("hasLoggedIn")?!0:!1,isBindPhone:F.context("isBindPhone")?!0:!1,isSubmitting:!1,ajaxOrderSubmitUrl:F.context("ajax_order_submit"),ajaxMiaoOrderSubmitUrl:F.context("ajax_miaoorder_submit"),orderWaitingUrl:F.context("order_waiting"),$submitBtn:$("#j-submitBtn"),bindEvent:function(){h.$submitBtn.on("click",h.handlers.submitClickHandler)
},handlers:{submitClickHandler:function(){if(h.hasLoggedIn){if(!d.isWuliu&&!h.isBindPhone)return void passBindPhone.bind();if(!h.checkSubmitParams())return;if(!pwd.getVm().canSubmit)return void alert("请填写红包交易密码或短信验证码~~");h.requestSubmit()}else loginApi.show()}},checkSubmitParams:function(){var t=!0;return d.isWuliu&&!d.check()&&(t=!1),l.needPersonal&&!l.checkAll()&&(t=!1),i.checkBuyCountAndSetErr()||(t=!1),t},getSubmitParams:function(){var t={dealId:i.getDealId(),price:i.getUnitPrice(),count:i.getBuyCount(),totalMoney:i.getUnitPrice()*i.getBuyCount(),selectedActivityId:r.getSelectedActivityId(),giftCardId:s.getVoucherId(),giftCardMoney:s.getVoucherMoney(),giftCardName:s.getVoucherName(),promoMoney:r.getPromoMoney(),promoDetail:r.getPromoDetail(),redPacketUsedMoney:c.getHongbaoMoney(),discountIds:r.getParamIds(),dealOption:i.getMultiPackOptions(),deliveryCost:d.getDeliveryCost(),address:d.isWuliu?d.get():null,money:u.get(),extInfo:l.needPersonal?l.getParams():null};return $.extend(t,h.client),t},requestSubmit:function(){if(!h.isSubmitting&&!e.isDiscountRequesting){h.isSubmitting=!0;var t=h.getSubmitParams(),n=h.ajaxOrderSubmitUrl;h.isSecKill?(n=h.ajaxMiaoOrderSubmitUrl,t.method="bnuoapi.tradecenter.miaocreate",$.ajax(n,{dataType:"jsonp",data:t,success:function(t){h.isSubmitting=!1,0==t.errno?(i.deleteData(),h._redirectToWaiting(t)):p.handle(t.errno,t)}})):$.post(n,t,function(t){if(h.isSubmitting=!1,0==t.errno)if(1==t.data.orderType)i.deleteData(),h._redirectToWaiting(t);else{var e=t.data.payUrl;e?(i.deleteData(),window.location=e):p.handleDefault(t)}else p.handle(t.errno,t)},"json");var o={ecom_order:{order_sum:t.money||"",prod:[{p_id:t.dealId||"",p_price:t.price||"",p_num:t.count||""}]}};F.context("tongji_hm").init({data:o})}},_redirectToWaiting:function(t){window.location.href=h.orderWaitingUrl+"?orderId="+t.data.orderId}},p={_errnoMap:{12020103:"20103"},handle:function(t){t&&/^120/.test(t)&&(t=(""+t).replace(/^120/,""));var e=this.handlers["handler"+t];"function"!=typeof e&&(e=this.handlers.handlerDefault),Array.prototype.shift.call(arguments),e.apply(null,arguments)},handleDefault:function(t){this.handlers.handlerDefault(t)},handlers:{handlerDefault:function(t){Dialog.alert({width:400,content:'<p class="order-dialog-content">'+t.msg+"</p>"})},handler20700:function(){var t='<p class="order-dialog-content">创建订单过于频繁，请稍后重试。</p>';Dialog.splash({width:500,title:"提示",customClassName:"ui-splash-order",content:t,timeout:3e3})},handler20100:function(){var t=['<p class="order-dialog-content">订单发生错误，请返回重新下单。</p>','<div class="button-wrap">','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="goback" value="返回重新下单" />',"</div>"].join(""),e=new Dialog({width:400,title:"提示",customClassName:"ui-dialog-order",content:t}).center().on("cancel",function(){clearTimeout(i),e.dispose()}).on("goback",function(){clearTimeout(i),e.dispose()}),i=setTimeout(function(){e.dispose(),location.hash="j-wuliuArea"},3e3)},handler20103:function(){passBindPhone.bind()},handler20218:function(){var t=['<p class="order-dialog-content">请选择商品类型和数量</p>','<div class="button-wrap">','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="goback" value="返回选择" />',"</div>"].join(""),e=new Dialog({width:400,title:"提示",customClassName:"ui-dialog-order",content:t}).center().on("cancel",function(){e.dispose(),location.hash="j-tableGoods"}).on("goback",function(){e.dispose(),location.hash="j-table-goods"})},handler30205:function(t){var e=t.data.client.giftCardName,i=['<p class="order-dialog-content">',e+'<span class="font24">已失效</span>',"</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-gray j-dialog-btn" data-event="goback" value="返回修改"/>','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="gonext" value="继续购买"/>',"</div>"].join(""),n=new Dialog({title:"提示",customClassName:"ui-dialog-order",content:i}).center().on("cancel",function(){location.hash="j-voucherRow",n.dispose(),s.cancelVoucherAndUpdateFinalPrice()}).on("goback",function(){location.hash="j-voucherRow",n.dispose(),s.cancelVoucherAndUpdateFinalPrice()}).on("gonext",function(){n.dispose(),s.cancelVoucherAndUpdateFinalPrice(),h.requestSubmit()})},handler30206:function(t){var e=['<p class="order-dialog-content">',"该订单不支持使用&nbsp;&nbsp;"+t.data.client.giftCardName,"</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-gray j-dialog-btn" data-event="goback" value="返回修改"/>','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="gonext" value="继续购买"/>',"</div>"].join(""),i=new Dialog({title:"提示",customClassName:"ui-dialog-order",content:e}).center().on("cancel",function(){location.hash="j-voucherRow",i.dispose(),s.cancelVoucherAndUpdateFinalPrice()}).on("goback",function(){location.hash="j-voucherRow",i.dispose(),s._resetVoucherAndUpdateFinalPrice()}).on("gonext",function(){i.dispose(),s.cancelVoucherAndUpdateFinalPrice(),h.requestSubmit()})},handler20201:function(t){var e=['<p class="order-dialog-content">',t.msg,"</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="goback" value="返回修改"/>',"</div>"].join(""),i=new Dialog({width:400,title:"提示",customClassName:"ui-dialog-order",content:e}).center().on("goback",function(){i.dispose(),location.hash="j-tableGoods"})},handler20204:function(t){var e=['<p class="order-dialog-content">',t.msg,"</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="goback" value="返回修改"/>',"</div>"].join(""),i=new Dialog({width:400,title:"提示",customClassName:"ui-dialog-order",content:e}).center().on("goback",function(){i.dispose(),location.hash="j-tableGoods"})},handler20203:function(t){var e=['<p class="order-dialog-content">',t.msg,"</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="goback" value="返回修改"/>',"</div>"].join(""),i=new Dialog({width:400,title:"提示",customClassName:"ui-dialog-order",content:e}).center().on("goback",function(){i.dispose(),location.hash="j-tableGoods"})},handler20201:function(){var t=['<p class="order-dialog-content">每次最多购买500件</p>','<div class="button-wrap">','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="goback" value="返回修改"/>',"</div>"].join(""),e=new Dialog({width:400,title:"提示",customClassName:"ui-dialog-order",content:t}).center().on("goback",function(){e.dispose(),location.hash="j-tableGoods"})},handler30708:function(){var t=['<p class="order-dialog-content">',"该团单无法使用红包","</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-gray j-dialog-btn" data-event="goback" value="返回修改"/>','<input type="button" class="btn-m btn-pink j-dialog-btn" data-event="gonext" value="继续购买"/>',"</div>"].join("");location.hash="";var e=new Dialog({title:"提示",customClassName:"ui-dialog-order",content:t}).center().on("cancel",function(){location.hash="j-voucherRow",e.dispose()}).on("goback",function(){location.hash="j-voucherRow",e.dispose()}).on("gonext",function(){e.dispose(),c.cancelHongbao(),u.updateFinalPrice(),h.requestSubmit()})},handler30709:function(){var t=['<p class="order-dialog-content">',"红包金额错误，请返回重新提交订单","</p>",'<div class="button-wrap">','<input type="button" class="btn-m btn-gray j-dialog-btn" data-event="goback" value="返回修改"/>',"</div>"].join("");location.hash="";var e=new Dialog({width:500,title:"提示",customClassName:"ui-dialog-order",content:t}).center().on("cancel",function(){location.hash="j-voucherRow",e.dispose(),i.requestAndUpdateFinalPrice()}).on("goback",function(){location.hash="j-voucherRow",e.dispose(),i.requestAndUpdateFinalPrice()})},handler300002:function(){var t=['<p class="order-dialog-content">',"温馨提示：此单已不能享受优惠活动，可继续正常购买，谢谢。","</p>"].join("");Dialog.alert({width:530,content:t,onok:function(){window.location.reload()}})},handler20704:function(t){var e=t.data.leftCount,i=t.data.mobile,n=t.data.passUid;i||(i=F.context("antiCheatMobileCy")),n||(n=F.context("antiCheatPassUidCy"));var o=new voiceCheck({passuid:n,avaiBtn:"j-avai-but-order",disableBut:"j-disable-but-order",waitingBut:"j-waiting-but-order",verifyCodeInput:"j-verify-input-order",verifyNow:"j-verify-now-order",errMsg:"j-err-msg-order"});o.antiCheatDialog(e,i)}}};t()});