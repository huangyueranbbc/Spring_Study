F.context("staticController").run(function(){var t=require("common:widget/ui/passport/passport.js"),e=require("common:widget/ui/dialog/dialog.js");$(function(){function n(){i(),b.ajaxGetAdInfoHandler(),s&&(b.handleSpecNavCeiling(),c&&b.handleSee2seeCeiling()),a()}function a(){require.async(["detail:widget/ui/change_pic/change_pic.js"],function(t){t.init()})}function i(){r.on("click",".j-ctrl span, .j-ctrl",w.buyCountCtrlClickHandler).on("keyup","input",w.buyCountInputKeyupHandler),$(".j-btn-buy").on("click",w.buyBtnClickHandler),s&&l.on("scroll",w.winScrollHandler)}var o=F.context("girlsHdDlgDetail");o+""=="1"&&new e.alert({width:520,title:"提示",content:"该团购3.7元秒杀已结束，您可用原团购价购买。",customClassName:"ui-dialog-girls-act-detail"}).center();var r=$(".j-item-buycount-row"),s=!0;if($.browser.msie&&$.browser.version<9&&(s=!1),s){var l=$(window),u=l.scrollTop(),d=$("#j-see2see"),c=d.size()>0;if(c)var p=d.offset().top,f=$("body").height()-$(".w-footer").outerHeight()-d.outerHeight();var h=$("#j-sn-ceiling"),g=h.offset()&&h.offset().top||0,v=!1,C=1}var w={buyCountCtrlClickHandler:function(t){var e=$(t.target);if(e.hasClass("j-ctrl")||(e=e.parent(),t.stopPropagation()),!e.hasClass("disabled")){var n=e.siblings("input"),a=n.val();n.val(e.hasClass("plus")?++a:--a),b.checkBuyCountAndSetErr(),b.updateBuyCount()}},buyCountInputKeyupHandler:function(t){var e=$(t.target),n=parseInt(e.val(),10);isNaN(n)&&(n=0),e.val(n),b.checkBuyCountAndSetErr(),b.updateBuyCount()},buyBtnClickHandler:function(e){var n=$(this),a=parseInt(r.find('input[type="text"]').val(),10),i=n.attr("href");!isNaN(a)&&a>0&&(i+=i.indexOf("?")>-1?"&count="+a:"?count="+a,n.attr("href",i)),e.preventDefault(),t.check(function(){n.hasClass("j-some-btn-buy")&&((new Image).src="http://hm.baidu.com/hm.gif?ep=%7Bid%3Aljgm%2CeventType%3Aclick%7D&et=1&nv=0&si=1ecc32f16b509b4859e79015ab9a9598&st=4&v=pixel-1.0&rnd="+Math.floor(Math.random()*Math.pow(2,31))),window.location.href=i},function(){t.show({u:n.attr("href")})})},winScrollHandler:function(){u=l.scrollTop(),f=$("body").height()-$(".w-footer").outerHeight()-d.outerHeight(),b.handleSpecNavCeiling(),c&&b.handleSee2seeCeiling()}},b={ajaxGetAdInfoHandler:function(){var t=F.context("nuomi_base")+"/mis/ad/ad?adarea_id=9,26";$.ajax({url:t,dataType:"jsonp",jsonp:"jsonp_callback",success:function(t){function e(t,e,n){if(t&&t.length>0){for(var a=0;a<t.length;++a){var i=t[a];e.append('<a class="ad-link" href="'+i.url+'" class="link" target="_blank" mon="element=adver_'+i.id+"&position=adver_"+(a+1)+'"><img src="'+i.img+'" alt="'+i.title+'"width="227" height="'+n+'"/></a>')}e.show()}}e(t.data[26],$("#detail-right-ad-first"),187),e(t.data[9],$("#detail-right-ad"),238)}})},updateBuyCount:function(){$row=r;var t=$row.find('[type="text"]'),e=t.siblings(".plus"),n=t.siblings(".minus"),a=$row.data("min"),i=$row.data("max"),o=t.val();a>=o?(n.addClass("disabled"),o=a):n.removeClass("disabled"),o>=i?(e.addClass("disabled"),o=i):e.removeClass("disabled"),t.val(o)},checkBuyCountAndSetErr:function(){$row=r;var t=$row.data("min"),e=$row.data("max"),n=$row.data("stock"),a=$row.data("personmax"),i=$row.find('[type="text"]'),o=i.val(),s=!1;return this.setBuyCountErr(""),t>o?(this.setBuyCountErr("每人最少购买"+t+"件"),location.hash="j-tableGoods"):o>e?this.setBuyCountErr(n>=a?"每人最多购买"+a+"件":"库存不足，最多可购买"+n+"件"):s=!0,s},setBuyCountErr:function(t){r.find(".j-err-wrap").html(t)},handleSee2seeCeiling:function(){p>u?(C="static",d.css({position:"static",top:"auto",zIndex:"auto"})):u>p&&f>u?(C="fixed",d.css({position:"fixed",top:v?51:0,zIndex:50})):(C="absolute",d.css({position:"absolute",top:f}))},handleSpecNavCeiling:function(){if(u>g){if(v)return;v=!0,h.addClass("spec-nav-fixed"),h.css({position:"fixed",top:0,zIndex:55})}else{if(!v)return;v=!1,h.removeClass("spec-nav-fixed"),h.css({position:"static",top:"auto",zIndex:"auto"})}},getUrlParam:function(t){var e=window.location.search;if(e){var n=new RegExp("(^|&|\\?)"+t+"=(([^&#]*)(&|#|$))"),a=e.match(n);return null!=a?a[2]:null}return null}};n()})});