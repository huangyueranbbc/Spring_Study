define("order:widget/password/factory/Abstract.js",function(e,t,n){function i(e,t,n){var i=e.store.hasOwnProperty(t)?"change":"add",r=e.store[t];return e.store[t]=n,r!==n?{type:i,name:t,oldValue:r,newValue:n}:null}var r=e("common:widget/dep/moye/lib.js"),s=e("common:widget/dep/moye/helper/state.js"),o=r.newClass({initialize:function(e){this.store={},this.states={},e=e||{},r.extend(this,e)},get:function(e){return this.store[e]},set:function(e,t,n){n=n||{};var r=i(this,e,t);if(r&&!n.silent){var s={changes:[r]};this.fire("change",s)}return t},fill:function(e,t){t=t||{};var n=[];for(var r in e)if(e.hasOwnProperty(r)){var s=i(this,r,e[r]);s&&n.push(s)}if(n.length&&!t.silent){var o={changes:n};this.fire("change",o)}return e},remove:function(e,t){if(this.store.hasOwnProperty(e)){t=t||{};var n=this.store[e];if(delete this.store[e],!t.silent){var i={changes:[{type:"remove",name:e,oldValue:n,newValue:void 0}]};this.fire("change",i)}return n}},setViewModel:function(e){this._viewModel=e},getViewModel:function(){return this._viewModel||null}}).implement(r.observable).implement(s);n.exports=o});
;define("order:widget/password/factory/RedPacket.js",function(e,t,n){var s=window.jQuery,o=e("order:widget/password/factory/Abstract.js"),r=e("common:widget/util/ejson.js"),c=e("common:widget/util/sms.js"),i=e("common:widget/util/encrypt.js"),u=o.extend({type:"RedPacket",initialize:function(e){this.$parent(e),this._usingHongbao=!0},getMaxMoney:function(){return this.get("redPacketMoney")||0},setMaxMoney:function(e){this.set("redPacketMoney",e)},getMoney:function(){return this.get("canUseHongbao")&&this._usingHongbao?parseInt(this._money,10)||0:0},setMoney:function(e){this._money=e},enable:function(){this._usingHongbao=!0},disable:function(){this._usingHongbao=!1},setUsing:function(e){this._usingHongbao=!!e},getUsing:function(){return this._usingHongbao},checkSecurity:function(e){return r.post("/uc/user/checksecurity",{data:{page:"order_create",pay:e}}).then(function(e){return e.errno=0,e},function(){return{errno:404,need_check:!1}})},checkUseHongbao:function(e){this.getUsing()&&this.checkSecurity(e.hongbaoMoney).always(function(t){return 0!==t.errno?void(e.activeHongbao=!1):void(t.need_check?(e.activeHongbao=!0,0===t.has_pwd?(e.$showPassword=!1,e.showSettingArea=!0,e.showPasswordArea=!1):(e.$showPassword=!0,e.showSmsArea=!1,e.showPasswordArea=!0)):e.$showPassword=!0)})},validatePassword:function(e){return r.post("/uc/user/checksecurepwd",{data:{pwd:i.encrypt(e)}}).then(function(e){return{ok:e.result,msg:e.msg}},function(e){return{ok:!1,msg:e.msg||"请求错误"}})},sendSms:function(){return this.createSms().send("/uc/user/securesms",{type:"checkorder"})},checkSmsCode:function(e){var t=e.value,n=this.createSms();return console.log("xxx"),s.trim(t)?n.validate("/uc/user/checksmscode",{type:"checkorder",code:t}).then(function(e){return{ok:e.result}},function(e){return{ok:!1,msg:e.msg}}):r.reject({msg:"验证码为空"})},createSms:function(){return this.sms||(this.sms=c.create("#sms-btn")),this.sms}});n.exports=u});
;define("order:widget/password/hongbao.js",function(e,d,o){var r=e("order:widget/password/factory/RedPacket.js"),a=new r;a.RedPacket=r,o.exports=a});
;define("order:widget/password/main.js",function(s,o,a){function n(s){if(!s.isShortage){var o={hongbao:["canUseHongbao","redPacketMoney"]};r(w,s,o.hongbao),i=d.define({$id:"hongbaoPassword",$min:s.min,$max:s.max,$stock:s.stock,$personMax:s.personMax,$dealId:s.dealId,hongbaoMoney:0,canUseHongBao:s.canUseHongbao,activeHongbao:!1,showPasswordArea:!1,showSettingArea:!1,showSmsArea:!1,smsBtn:!1,smsMsg:"",passwordOk:!1,passwordErr:!1,$passwordOk:!1,checkPasswordMsg:"",$showPassword:!1,canSubmit:{get:function(){return!this.activeHongbao||this.$passwordOk}},checkHongBao:function(){if(i.canUseHongBao){i.activeHongbao=!i.activeHongbao;var s=!!i.activeHongbao;w.setUsing(s),i.hongbaoMoney=s?w.getMoney():0}},hongbaoSmsCheck:function(){var s="yes"===this.getAttribute("data-sms");i.showSmsArea=s,i.$showPassword?i.showPasswordArea=!s:i.showSettingArea=!s},resetPassword:function(){i.checkPasswordMsg="",i.passwordOk=i.passwordErr=!1},validatePassword:function(){var s=c.trim(this.value);i.checkPasswordMsg="",!s||s.length<6||w.validatePassword(s).always(function(s){i.$passwordOk=i.passwordOk=s.ok,i.passwordErr=!s.ok,i.checkPasswordMsg=s.msg,i.$fire("canSubmit")})},getSms:function(){w.sendSms().always(function(s){console.info(s),i.smsMsg=s.msg}),i.$passwordOk=i.passwordErr=i.passwordOk=!1},checkSmsCode:function(){var s=this.value;!s||s.length<4||w.checkSmsCode(this).always(function(s){i.smsMsg=s.ok?"验证码正确":s.msg,i.$passwordOk=s.ok,i.$fire("canSubmit")})},bindPhoneNumber:function(){g.bind()}}),i.$watch("activeHongbao",function(){i.$fire("canSubmit")}),i.$watch("$passwordOk",function(){}),i.$watch("canSubmit",function(){var s=i.canSubmit?"removeClass":"addClass";c("#j-submitBtn")[s]("state-disable")}),d.scan(),w.setMoney(s.hongbaoMoney)}}function e(){return i}function t(){w.checkUseHongbao(i)}function r(s,o,a){c.each(a,function(a,n){s.set(n,o[n])})}var i,c=window.jQuery,d=s("common:widget/dep/avalon/avalon.js"),w=s("order:widget/password/hongbao.js"),g=s("common:widget/ui/passport_bind_phone/passport_bind_phone.js");a.exports={init:n,getVm:e,checkUseHongbao:t}});